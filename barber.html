<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&family=Sora:wght@100..800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/STATIC/CSS/barber.css" />
    <link
      rel="icon"
      type="image/png"
      href="/STATIC/Images/icons/trimly logo.svg"
    />
    <title>Barber Profile</title>
    <style>
      .comment-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      
      .comment-modal.open {
        display: flex;
      }
      
      .comment-box {
        background: white;
        border-radius: 12px;
        padding: 30px;
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
      }
      
      .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      
      .comment-header h3 {
        margin: 0;
        font-size: 20px;
        color: #1A1A1A;
      }
      
      .close-comment {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
      }
      
      .rating-input {
        margin: 20px 0;
      }
      
      .rating-input label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
      }
      
      .star-rating {
        display: flex;
        gap: 8px;
        direction: rtl;
      }
      
      .star-rating input {
        display: none;
      }
      
      .star-rating label {
        font-size: 30px;
        color: #ddd;
        cursor: pointer;
        transition: color 0.2s;
      }
      
      .star-rating label:hover,
      .star-rating label:hover ~ label,
      .star-rating input:checked ~ label {
        color: #ffd700;
      }
      
      .comment-input textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: inherit;
        font-size: 14px;
        resize: vertical;
        min-height: 100px;
        margin-top: 10px;
      }
      
      .submit-comment-btn {
        background: #00A859;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        transition: background 0.3s;
      }
      
      .submit-comment-btn:hover {
        background: #008F4C;
      }
      
      .review-count {
        color: #666;
        font-size: 14px;
      }
      
      .rating-breakdown {
        margin-top: 20px;
      }
      
      .bar-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }
      
      .bar-row span {
        width: 20px;
        text-align: right;
        color: #666;
      }
      
      .bar {
        flex: 1;
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
      }
      
      .bar div {
        height: 100%;
        background: #00A859;
        border-radius: 4px;
      }
      
      .summary-count {
        color: #666;
        margin-top: 5px;
      }


      /* Yellow Add Review Button */
.add-comment-btn {
  background: #FFD700 !important;
  color: #333 !important;
  border: none !important;
  border-radius: 8px !important;
  padding: 12px 24px !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  display: flex !important;
  align-items: center !important;
  gap: 8px !important;
  transition: all 0.3s !important;
  box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2) !important;
}

.add-comment-btn:hover {
  background: #FFC400 !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3) !important;
}

.add-comment-btn span {
  font-size: 18px !important;
  font-weight: bold !important;
}

/* Yellow Review Summary Header */
.summary-rating h1 {
  color: #FFD700 !important;
  text-shadow: 0 2px 4px rgba(255, 215, 0, 0.2) !important;
}

/* Yellow Submit Button */
.submit-comment-btn {
  background: #FFD700 !important;
  color: #333 !important;
  border: none !important;
  border-radius: 8px !important;
  padding: 14px 24px !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  width: 100% !important;
  margin-top: 20px !important;
  transition: all 0.3s !important;
  box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2) !important;
}

.submit-comment-btn:hover {
  background: #FFC400 !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3) !important;
}

/* Yellow Rating Breakdown Bars */
.bar div {
  background: #FFD700 !important;
  box-shadow: 0 1px 4px rgba(255, 215, 0, 0.3) !important;
}

/* Yellow Stars in Star Rating */
.star-rating label {
  color: #ddd !important;
  transition: color 0.2s !important;
}

.star-rating label:hover,
.star-rating label:hover ~ label,
.star-rating input:checked ~ label {
  color: #FFD700 !important;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5) !important;
}

/* Button positions - moved to bottom right */
.reviews-header {
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
  position: relative !important;
}

.reviews-header > div:last-child {
  display: flex !important;
  gap: 12px !important;
  align-items: center !important;
}

/* Modal header adjustments */
.modal-header {
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
}

.modal-header-right {
  display: flex !important;
  align-items: center !important;
  gap: 12px !important;
}

/* Review summary stars color */
.summary-stars {
  color: #FFD700 !important;
  font-size: 20px !important;
  margin: 10px 0 !important;
}

/* Position container for buttons at bottom right of reviews section */
.reviews-section {
  position: relative;
  min-height: 400px; /* Adjust based on your layout */
}

.reviews-section .reviews-header > div:last-child {
  position: absolute;
  bottom: 20px;
  right: 20px;
}

/* OR if you want it outside the header but still in the section */
.add-review-bottom-right {
  position: absolute;
  bottom: 20px;
  right: 20px;
  z-index: 10;
}

/* Position add review button at bottom right of modal */
.modal-header-right {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 12px;
}

/* For reviews section bottom right button */
.reviews-section {
  position: relative;
  padding-bottom: 80px; /* Add space for the button */
}

.add-review-bottom-right {
  position: absolute;
  bottom: 10;
  right: 10;
  z-index: 10;
}

/* For modal bottom right button */
.modal-inner {
  position: relative;
  min-height: 400px;
}

.modal-bottom-right {
  position: absolute;
  bottom: 20px;
  right: 20px;
  z-index: 1001;
}


/* For sticky bottom button in modal */
.modal-inner {
  position: relative;
  display: flex;
  flex-direction: column;
  height: 100%;
  max-height: 90vh;
}

.modal-review-list {
  flex: 1;
  overflow-y: auto;
  max-height: 60vh;
  margin-bottom: 20px;
}

.modal-bottom-container {
  padding: 20px;
  border-top: 1px solid #e5e5e5;
  background: white;
  position: sticky;
  bottom: 0;
  display: flex;
  justify-content: flex-end;
  z-index: 10;
}

/* Adjust modal height */
.reviews-modal .modal-inner {
  max-height: 85vh;
  overflow: hidden;
}
    </style>
  </head>

  <body>
    <div class="app-container">
      <div id="mobile-overlay"></div>
      <!-- SIDEBAR -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="logo-area">
            <span class="logo-text">Trimly</span>
            <i class="nav-icon sidebar-toggle-icon">
              <img src="/STATIC/Images/icons/trimly logo.svg" alt="" />
            </i>
          </div>
        </div>

        <nav class="nav-list">
          <a href="Home.html" class="nav-item active">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/Vector.svg"
            /></i>
            <span class="nav-label">Home</span>
          </a>

          <a href="favourite.html" class="nav-item">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/mynaui_heart.svg"
            /></i>
            <span class="nav-label">Favourite</span>
          </a>

          <a href="message.html" class="nav-item">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/message.svg"
            /></i>
            <span class="nav-label">Messages</span>
          </a>

          <a href="booking.html" class="nav-item">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/bookings.svg"
            /></i>
            <span class="nav-label">Bookings</span>
          </a>

          <a href="setting.html" class="nav-item">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/settings.svg"
            /></i>
            <span class="nav-label">Settings</span>
          </a>
        </nav>

        <div class="social-icons">
          <a href="#"><img src="/STATIC/Images/fb.svg" /></a>
          <a href="#"><img src="/STATIC/Images/icons/ig.svg" /></a>
          <a href="#"><img src="/STATIC/Images/icons/x.svg" /></a>
          <a href="#"><img src="/STATIC/Images/icons/messenger.svg" /></a>
        </div>
      </aside>

      <!-- HAMBURGER -->
      <button
        id="hamburger-btn"
        class="hamburger-btn"
        aria-label="Toggle sidebar"
      >
        <img src="/STATIC/Images/icons/trimly logo.svg" alt="menu" />
      </button>

      <main class="main-content">
        <header class="top-bar">
          <div class="search-container">
            <img src="/STATIC/Images/search.svg" />
            <input id="searchBar" class="search-input" placeholder="Search" />
          </div>

          <div class="notificationwithprofile">
            <div class="notifications">
              <img
                src="/STATIC/Images/icons/notificatiion.svg"
                alt="Notifications"
              />
              <span
                class="notification-badge"
                data-count="0"
                id="notificationCount"
                >0</span
              >
            </div>

            <div class="profile">
              <div class="avatar avatar-image">T</div>
            </div>
          </div>
        </header>

        <div id="barber-container" class="content-scroll-area"></div>
      </main>
    </div>

    <script>
      const bc =
        "BroadcastChannel" in window
          ? new BroadcastChannel("trimly-favourites")
          : null;

      function getFavourites() {
        try {
          return JSON.parse(localStorage.getItem("favourites")) || [];
        } catch {
          return [];
        }
      }

      function setFavourites(arr) {
        localStorage.setItem("favourites", JSON.stringify(arr));
        localStorage.setItem("favourites_updated", Date.now());
        if (bc) bc.postMessage({ type: "favourites_changed" });
      }

      function toggleFavouriteById(id) {
        id = String(id);
        let favs = getFavourites();

        if (favs.includes(id)) {
          favs = favs.filter((x) => x !== id);
        } else {
          favs.push(id);
        }

        setFavourites(favs);
      }

      /************************
       * 1. GET BARBER ID
       ************************/
      const params = new URLSearchParams(window.location.search);
      const barberId = params.get("id");

      /************************
       * 2. BARBERS DATABASE (UPDATED WITH NEW REVIEWS)
       ************************/
      const barbers = {
        1: {
          id: "1",
          name: "Ariyo barbing services",
          img: "/STATIC/Images/e3e57f5dd5ab20b760d3f389da7910e955587728.jpg",
          location: "Lagos",
          amount: 5000,
          desc: "Premium Lagos barbershop known for sharp fades, afro grooming, and clean modern cuts.",
          verified: true,
          priceTier: "mid",
          availability: [17, 24, 19, 29, 27, 5, 1, 22, 6, 10],
          reviews: [
            {
              id: 1,
              name: "David Adepoju",
              avatar: "/STATIC/Images/icons/Frame review.png",
              rating: 5,
              date: "June 10, 2025",
              text: "Amazing service! My fade came out clean and sharp. Easily one of the best barbers in Lagos.",
            },
            {
              id: 2,
              name: "Michael Femi",
              avatar: "/STATIC/Images/icons/Frame review2.png",
              rating: 4,
              date: "June 5, 2025",
              text: "Good attention to detail. The shop was neat and he kept to time.",
            },
            {
              id: 3,
              name: "Tunde Ilori",
              avatar: "/STATIC/Images/icons/Frame review3.png",
              rating: 5,
              date: "May 28, 2025",
              text: "Best haircut I've had in months. Highly recommended.",
            },
          ],
          workingHours: [{ start: "07:00", end: "22:00" }],
        },

        2: {
          id: "2",
          name: "Fola barbing services",
          img: "/STATIC/Images/51dff4b5b6c4b24a89fc357e76ddb4bffa5f60cb.jpg",
          location: "Abuja",
          amount: 2500,
          desc: "Affordable neighborhood barbershop offering simple, clean haircuts at great value.",
          verified: false,
          priceTier: "low",
          availability: [16, 1, 3, 23, 7, 22, 19, 26, 25, 11],
          reviews: [
            {
              id: 1,
              name: "Chibuzo Kingsley",
              avatar: "/STATIC/Images/icons/Frame review.png",
              rating: 3,
              date: "May 12, 2025",
              text: "Decent cut. Could improve timing but overall fair.",
            },
            {
              id: 2,
              name: "Aisha Bello",
              avatar: "/STATIC/Images/icons/Frame review2.png",
              rating: 4,
              date: "May 1, 2025",
              text: "Pleasant service, friendly barber. Good pricing.",
            },
            {
              id: 3,
              name: "Yusuf Ahmed",
              avatar: "/STATIC/Images/icons/Frame review3.png",
              rating: 2,
              date: "April 20, 2025",
              text: "Cut was okay but not exactly what I asked for.",
            },
          ],
          workingHours: [{ start: "07:00", end: "22:00" }],
        },

        3: {
          id: "3",
          name: "Adebisi barbing services",
          img: "/STATIC/Images/fd5eaeb566eaee245f79cac02879dbca4d66fb74.jpg",
          location: "Ibadan",
          amount: 4000,
          desc: "Professional Ibadan barber specializing in detailed fades, beard trims, and styling.",
          verified: true,
          priceTier: "mid",
          availability: [16, 13, 20, 24, 6, 8, 21, 25, 17, 3],
          reviews: [
            {
              id: 1,
              name: "Kunle Owolabi",
              avatar: "/STATIC/Images/icons/Frame review.png",
              rating: 4,
              date: "June 2, 2025",
              text: "Very professional. My beard trim came out sharp.",
            },
            {
              id: 2,
              name: "Samuel Peters",
              avatar: "/STATIC/Images/icons/Frame review2.png",
              rating: 5,
              date: "May 27, 2025",
              text: "Excellent work. Definitely coming back.",
            },
            {
              id: 3,
              name: "Ireti A.",
              avatar: "/STATIC/Images/icons/Frame review3.png",
              rating: 4,
              date: "May 10, 2025",
              text: "Neat shop and good vibes. Loved the haircut.",
            },
          ],
          workingHours: [{ start: "07:00", end: "22:00" }],
        },

        4: {
          id: "4",
          name: "African barbing services",
          img: "/STATIC/Images/71954b1bf5bf641a949aa7d9565112e807cd9a25.jpg",
          location: "Ibadan",
          amount: 6500,
          desc: "Luxury grooming experience with premium tools, skilled barbers, and stylish ambience.",
          verified: false,
          priceTier: "high",
          availability: [10, 12, 14, 16, 4, 13, 22, 15, 9, 1],
          reviews: [
            {
              id: 1,
              name: "Precious Daniel",
              avatar: "/STATIC/Images/icons/Frame review.png",
              rating: 4,
              date: "June 9, 2025",
              text: "Good service but a little pricey.",
            },
            {
              id: 2,
              name: "Emeka U.",
              avatar: "/STATIC/Images/icons/Frame review2.png",
              rating: 5,
              date: "June 1, 2025",
              text: "Great haircut, worth the money.",
            },
            {
              id: 3,
              name: "Ola N.",
              avatar: "/STATIC/Images/icons/Frame review3.png",
              rating: 3,
              date: "May 19, 2025",
              text: "Decent but expected a bit more for the price.",
            },
          ],
          workingHours: [{ start: "07:00", end: "22:00" }],
        },

        5: {
          id: "5",
          name: "Ayodele barbing services",
          img: "/STATIC/Images/89f0e267a3761a55a184609ef53967fc6beed6e6.jpg",
          location: "Abuja",
          amount: 3000,
          desc: "Quick and reliable barber service ideal for regular maintenance cuts and trims.",
          verified: false,
          priceTier: "low",
          availability: [8, 21, 16, 7, 28, 30, 1, 6, 24, 13],
          reviews: [
            {
              id: 1,
              name: "Henry Okafor",
              avatar: "/STATIC/Images/icons/Frame review.png",
              rating: 4,
              date: "June 3, 2025",
              text: "Affordable and clean cut. Good value.",
            },
            {
              id: 2,
              name: "Sade Ojo",
              avatar: "/STATIC/Images/icons/Frame review2.png",
              rating: 3,
              date: "May 25, 2025",
              text: "Okay haircut, nothing extraordinary.",
            },
            {
              id: 3,
              name: "Daniel O.",
              avatar: "/STATIC/Images/icons/Frame review3.png",
              rating: 5,
              date: "May 14, 2025",
              text: "Excellent job. Will be returning.",
            },
          ],
          workingHours: [{ start: "07:00", end: "22:00" }],
        },

        6: {
          id: "6",
          name: "Rise barbing services",
          img: "/STATIC/Images/7e4c3695e25ee081e122f0dac2c4f7c7b0c3ccce.jpg",
          location: "Lagos",
          amount: 8000,
          desc: "High-end barbershop delivering premium fades, luxury grooming, and elite service.",
          verified: true,
          priceTier: "high",
          availability: [21, 13, 11, 28, 22, 10, 5, 2, 18, 7],
          reviews: [
            {
              id: 1,
              name: "Favour Chinedu",
              avatar: "/STATIC/Images/icons/Frame review.png",
              rating: 5,
              date: "June 8, 2025",
              text: "Top-notch! The fade was perfect and the service was premium.",
            },
            {
              id: 2,
              name: "Olawale Ade",
              avatar: "/STATIC/Images/icons/Frame review2.png",
              rating: 4,
              date: "June 4, 2025",
              text: "Loved the experience, great ambience.",
            },
            {
              id: 3,
              name: "Kelvin U.",
              avatar: "/STATIC/Images/icons/Frame review3.png",
              rating: 5,
              date: "May 29, 2025",
              text: "Perfect haircut every time. Highly skilled barber.",
            },
          ],
          workingHours: [{ start: "07:00", end: "22:00" }],
        },
      };


      // Function to get barber data with dynamic rating
function getBarberWithDynamicRating(barberId) {
  const barberData = JSON.parse(JSON.stringify(originalBarbers[barberId]));
  
  // Load saved reviews
  const savedReviews = loadBarberReviews(barberId);
  if (savedReviews) {
    barberData.reviews = savedReviews;
  }
  
  // Calculate dynamic rating
  barberData.rating = calculateAverageRating(barberData.reviews);
  
  return barberData;
}

// Function to get all barbers with dynamic ratings
function getAllBarbersWithRatings() {
  const barbersWithRatings = {};
  
  Object.keys(originalBarbers).forEach(id => {
    barbersWithRatings[id] = getBarberWithDynamicRating(id);
  });
  
  return barbersWithRatings;
}

// Function to save updated barber data
function saveBarberData(barberId, barberData) {
  // Save reviews to localStorage
  saveBarberReviews(barberId, barberData.reviews);
  
  // Also save the complete barber data for quick access on other pages
  localStorage.setItem(`barber_${barberId}_data`, JSON.stringify({
    ...barberData,
    rating: barberData.rating
  }));
  
  // Broadcast that barber data has changed
  if (bc) bc.postMessage({ 
    type: "barber_data_changed", 
    barberId: barberId 
  });
}

// Function to load barber data
function loadBarberData(barberId) {
  const savedData = localStorage.getItem(`barber_${barberId}_data`);
  if (savedData) {
    return JSON.parse(savedData);
  }
  return getBarberWithDynamicRating(barberId);
}

      // Function to calculate average rating dynamically
      function calculateAverageRating(reviews) {
        if (!reviews || reviews.length === 0) return 0;
        const total = reviews.reduce((sum, review) => sum + review.rating, 0);
        return total / reviews.length;
      }

      // Function to get rating breakdown
      function getRatingBreakdown(reviews) {
        const breakdown = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 };
        reviews.forEach((review) => {
          breakdown[review.rating]++;
        });
        return breakdown;
      }

      // Function to calculate percentage for each rating
      function calculateRatingPercentages(reviews) {
        const breakdown = getRatingBreakdown(reviews);
        const total = reviews.length;
        const percentages = {};
        for (let i = 1; i <= 5; i++) {
          percentages[i] = total > 0 ? (breakdown[i] / total) * 100 : 0;
        }
        return percentages;
      }


      // Function to save reviews to localStorage
function saveBarberReviews(barberId, reviews) {
  localStorage.setItem(`barber_${barberId}_reviews`, JSON.stringify(reviews));
}

// Function to load reviews from localStorage
function loadBarberReviews(barberId) {
  const savedReviews = localStorage.getItem(`barber_${barberId}_reviews`);
  if (savedReviews) {
    return JSON.parse(savedReviews);
  }
  return null;
}


      /************************
       * 3. RENDER BARBER (UPDATED)
       ************************/
      function renderBarber() {
        const barber = barbers[barberId];
        const container = document.getElementById("barber-container");

        if (!barber) {
          container.innerHTML = "<p>Barber not found.</p>";
          return;
        }

         // Load saved reviews from localStorage
  const savedReviews = loadBarberReviews(barberId);
  if (savedReviews) {
    barber.reviews = savedReviews;
  }

        // Calculate dynamic values
        const averageRating = calculateAverageRating(barber.reviews);
        const ratingPercentages = calculateRatingPercentages(barber.reviews);
        const ratingBreakdown = getRatingBreakdown(barber.reviews);

        // MAIN TEMPLATE
        container.innerHTML = `
  <!-- BACK -->
  <div class="header-row">
    <button class="back-btn" onclick="window.location.href='home.html';">
      <img src="/STATIC/Images/icons/Frame 1000009185.png" alt="Back">
      <span class="page-title">Back to other barbers</span>
    </button>
  </div>

  <div class="profile-layout">
    <div class="profile-left">
      <div class="profile-gallery">
        <div class="thumb-column">
          <img src="${barber.img}" class="thumb" />
          <img src="${barber.img}" class="thumb" />
          <img src="${barber.img}" class="thumb" />
          <img src="${barber.img}" class="thumb" />
        </div>
        <img class="main-img" src="${barber.img}" />
      </div>
      <button class="book-service-btn">Book Service</button>
      <div class="barber-info-card">
        <h2 class=barber-name><img src="/STATIC/Images/icons/barber-profile.png" alt="profile-barber">${barber.name}</h2>
        <p class="location">
          <img src="/STATIC/Images/icons/typcn_location.svg" style="width:14px;">
          ${barber.location}
        </p>
        <p class="desc">${barber.desc}</p>
      </div>
    </div>

    <div class="profile-right">
      <p id="calendar-header-text">Days Available</p>
      <div class="calendar-card">
        <h4 id="calendar-month"></h4>
        <div class="calendar-grid" id="calendar-grid"></div>
        <div class="legend">
          <div><span class="dot available-dot"></span> Days Available</div>
          <div><span class="dot unavailable-dot"></span> Days Unavailable</div>
        </div>
      </div>

      <div class="quick-actions-card">
        <p id="quick-action-text">Quick Actions</p>
        <button id="message-barber-btn" class="action-btn">
          <span class="left-content">
            <img src="/STATIC/Images/icons/message.svg" /> Message Barber
          </span>
        </button>
        <button id="fav-btn" class="action-btn">
          <img id="fav-icon" src="/STATIC/Images/icons/mynaui_heart (1).png">
          <span id="fav-text" class="left-content"> Add to Favourite</span>
        </button>
      </div>
    </div>
  </div>

  <!-- REVIEWS SECTION -->
<section class="reviews-section reviews-full-width">
  <div class="reviews-header">
    <div>
      <h3>Verified Customer Reviews</h3>
    </div>
    <div>
      <button id="open-see-all" class="see-all-btn">See All <img src="/STATIC/Images/icons/iconamoon_arrow-right-2-duotone green.png" /></button>
    </div>
  </div>

  <div class="reviews-content">
    <aside class="reviews-summary-card">
      <div class="summary-rating">
        <h1>${averageRating.toFixed(1)}<span>/5</span></h1>
        <div class="summary-stars">${generateStars(averageRating)}</div>
        <p class="summary-count">${barber.reviews.length} Verified ratings</p>
      </div>
      <div class="rating-breakdown">
        ${[5, 4, 3, 2, 1].map(rating => `
          <div class="bar-row">
            <span>${rating}</span>
            <div class="bar">
              <div style="width:${ratingPercentages[rating]}%"></div>
            </div>
            <span class="review-count">(${ratingBreakdown[rating]})</span>
          </div>
        `).join('')}
      </div>
    </aside>

    <div class="preview-and-more">
      <div id="preview-review-list" class="review-list"></div>
      <button id="open-see-more" class="see-more-link">See More Reviews</button>
    </div>
  </div>
  
  <!-- Add review button at bottom right -->
  <div class="add-review-bottom-right">
    <button id="add-comment-btn" class="add-comment-btn">
      <span>+</span> Add Review
    </button>
  </div>
</section>

  <!-- REVIEWS MODAL -->
<div id="reviewsModal" class="reviews-modal" aria-hidden="true" role="dialog" aria-label="Reviews modal">
  <div class="modal-overlay" id="modalOverlay"></div>
  <div class="modal-inner" role="document">
    <header class="modal-header">
      <div>
        <h2 class=barber-name><img src="/STATIC/Images/icons/barber-profile.png" alt="profile-barber">${barber.name}</h2>
        <p class="kicker">Ratings & Reviews</p>
      </div>
      <button id="modalClose" class="modal-close" aria-label="Close modal">&times;</button>
    </header>

    <div class="modal-controls">
      <button class="filter-btn">Star Ratings ‚ñæ</button>
      <button class="filter-btn">Most Relevant ‚ñæ</button>
    </div>

    <div id="modal-review-list" class="modal-review-list"></div>
    
    <!-- Add review button at bottom of modal (inside content) -->
    <div class="modal-bottom-container">
      <button id="add-review-in-modal" class="add-comment-btn">
        <span>+</span> Add Review
      </button>
    </div>
  </div>
</div>

  <!-- COMMENT MODAL -->
  <div id="commentModal" class="comment-modal">
    <div class="comment-box">
      <header class="comment-header">
        <h3>Add Your Review</h3>
        <button class="close-comment">&times;</button>
      </header>
      
      <div class="rating-input">
        <label>Your Rating</label>
        <div class="star-rating">
          <input type="radio" id="star5" name="rating" value="5" />
          <label for="star5">‚òÖ</label>
          <input type="radio" id="star4" name="rating" value="4" />
          <label for="star4">‚òÖ</label>
          <input type="radio" id="star3" name="rating" value="3" />
          <label for="star3">‚òÖ</label>
          <input type="radio" id="star2" name="rating" value="2" />
          <label for="star2">‚òÖ</label>
          <input type="radio" id="star1" name="rating" value="1" />
          <label for="star1">‚òÖ</label>
        </div>
      </div>
      
      <div class="comment-input">
        <label>Your Review</label>
        <textarea id="reviewText" placeholder="Share your experience with this barber..."></textarea>
      </div>
      
      <button id="submitReview" class="submit-comment-btn">Submit Review</button>
    </div>
  </div>
`;

        // Helper function to generate star HTML
      function generateStars(rating) {
  const fullStars = Math.floor(rating);
  const halfStar = rating % 1 >= 0.5;
  const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
  
  // Using colored stars
  let stars = '';
  for (let i = 0; i < fullStars; i++) {
    stars += '<span style="color: #FFD700;">‚òÖ</span>';
  }
  if (halfStar) {
    stars += '<span style="color: #FFD700;">¬Ω</span>';
  }
  for (let i = 0; i < emptyStars; i++) {
    stars += '<span style="color: #ddd;">‚òÜ</span>';
  }
  
  return stars;
}

        // Helper to render a review block
        function reviewHTML(r) {
  const stars = Array.from({length: 5}, (_, i) => 
    i < r.rating ? 
    '<span style="color: #FFD700;">‚òÖ</span>' : 
    '<span style="color: #ddd;">‚òÜ</span>'
  ).join('');
  
  return `
    <article class="review-item">
      <img src="${r.avatar}" class="review-avatar" alt="${r.name}">
      <div class="review-content">
        <div class="review-header">
          <h4>${r.name}</h4>
          <div class="review-stars">${stars}</div>
        </div>
        <span class="date">${r.date}</span>
        <p class="review-text">${r.text}</p>
      </div>
    </article>
  `;
}

        // Populate preview reviews
        const previewEl = document.getElementById("preview-review-list");
        previewEl.innerHTML = barber.reviews
          .slice(0, 3)
          .map(r => reviewHTML(r))
          .join("");

        // Populate modal with all reviews
        const modalList = document.getElementById("modal-review-list");
        modalList.innerHTML = barber.reviews.map(r => reviewHTML(r)).join("");

        // Initialize calendar
        initializeCalendar(barber);

        // Initialize event listeners
        initializeEventListeners(barber);

        // Initialize favourite button
        initializeFavouriteButton(barber);

        // Initialize message button
        initializeMessageButton(barber);
      }

      // Calendar initialization
      function initializeCalendar(barber) {
        const monthNames = [
          "January", "February", "March", "April", "May", "June",
          "July", "August", "September", "October", "November", "December"
        ];
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        document.getElementById("calendar-month").textContent = `${monthNames[month]} ${year}`;
        
        const calendarGrid = document.getElementById("calendar-grid");
        const availableDays = barber.availability || [];

        calendarGrid.innerHTML = Array.from({ length: daysInMonth }, (_, i) => {
          const day = i + 1;
          const isAvailable = availableDays.includes(day);
          return `
            <div class="cal-day ${isAvailable ? "available" : "unavailable"}">
              ${day}
            </div>
          `;
        }).join("");
      }

      // Event listeners initialization
      function initializeEventListeners(barber) {
        // Modal open/close
        const modal = document.getElementById("reviewsModal");
        const modalOverlay = document.getElementById("modalOverlay");
        const openSeeAll = document.getElementById("open-see-all");
        const openSeeMore = document.getElementById("open-see-more");
        const closeBtn = document.getElementById("modalClose");
        const addCommentBtn = document.getElementById("add-comment-btn");
        const addReviewInModal = document.getElementById("add-review-in-modal");
        const commentModal = document.getElementById("commentModal");
        const closeCommentBtn = document.querySelector(".close-comment");
        const submitReviewBtn = document.getElementById("submitReview");

        function showModal() {
          modal.setAttribute("aria-hidden", "false");
          modal.classList.add("open");
          closeBtn.focus();
          document.body.style.overflow = "hidden";
        }

        function hideModal() {
          modal.setAttribute("aria-hidden", "true");
          modal.classList.remove("open");
          document.body.style.overflow = "";
        }

        function showCommentModal() {
          commentModal.classList.add("open");
          document.body.style.overflow = "hidden";
        }

        function hideCommentModal() {
          commentModal.classList.remove("open");
          document.body.style.overflow = "";
        }

        // Add review function
function addReview(rating, text) {
  const barber = barbers[barberId];
  const newReview = {
    id: Date.now(),
    name: "You",
    avatar: "/STATIC/Images/icons/Frame review.png",
    rating: parseInt(rating),
    date: new Date().toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    }),
    text: text
  };

  // Add to barber's reviews
  barber.reviews.unshift(newReview);
  
  // Calculate and update rating
  const newAverageRating = calculateAverageRating(barber.reviews);
  barber.rating = newAverageRating; // Add this line
  
  // Save updated reviews AND rating
  localStorage.setItem(`barber_${barberId}_reviews`, JSON.stringify(barber.reviews));
  localStorage.setItem(`barber_${barberId}_rating`, newAverageRating.toString());
  
  // Save to all barbers data
  const allBarbersData = JSON.parse(localStorage.getItem('all_barbers_data')) || {};
  allBarbersData[barberId] = {
    reviews: barber.reviews,
    rating: newAverageRating,
    lastUpdated: new Date().toISOString()
  };
  localStorage.setItem('all_barbers_data', JSON.stringify(allBarbersData));

  // Re-render the page
  renderBarber();
  
  // Show success message
  showToast("Thank you for your review!");
}
        // Event listeners
        openSeeAll && openSeeAll.addEventListener("click", showModal);
        openSeeMore && openSeeMore.addEventListener("click", showModal);
        closeBtn.addEventListener("click", hideModal);
        modalOverlay.addEventListener("click", hideModal);

        addCommentBtn && addCommentBtn.addEventListener("click", showCommentModal);
        addReviewInModal && addReviewInModal.addEventListener("click", showCommentModal);
        closeCommentBtn && closeCommentBtn.addEventListener("click", hideCommentModal);

      submitReviewBtn && submitReviewBtn.addEventListener("click", () => {
  const rating = document.querySelector('input[name="rating"]:checked');
  const text = document.getElementById("reviewText").value.trim();

  if (!rating) {
    alert("Please select a rating");
    return;
  }

  if (!text) {
    alert("Please write a review");
    return;
  }

  // Save review with persistence
  addReview(rating.value, text);
  hideCommentModal();
  
  // Clear the form
  document.querySelectorAll('input[name="rating"]').forEach(input => input.checked = false);
  document.getElementById("reviewText").value = "";
});

        // Close comment modal on overlay click
        commentModal.addEventListener("click", (e) => {
          if (e.target === commentModal) {
            hideCommentModal();
          }
        });

        // Escape key to close modals
        window.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            hideModal();
            hideCommentModal();
          }
        });
      }

      // Favourite button initialization
      function initializeFavouriteButton(barber) {
        const favBtn = document.getElementById("fav-btn");
        const favText = document.getElementById("fav-text");
        const favIcon = document.getElementById("fav-icon");

        function updateFavUI() {
          const favs = getFavourites();
          const isFav = favs.includes(barber.id);

          favText.textContent = isFav
            ? "Remove from Favourite"
            : "Add to Favourite";

          favIcon.src = isFav
            ? "/STATIC/Images/icons/mynaui_heart (1).png"
            : "/STATIC/Images/icons/mynaui_heart-solid.png";
        }

        updateFavUI();

        favBtn.addEventListener("click", () => {
          toggleFavourite(barber.id, barber.name);
          updateFavUI();
        });
      }

      // Message button initialization
      function initializeMessageButton(barber) {
        const messageBtn = document.getElementById("message-barber-btn");
        messageBtn.onclick = () => {
          localStorage.setItem("activeChatBarberId", barber.id);
          window.location.href = `message.html?barberId=${barber.id}`;
        };
      }

      // Toast notification
      function showToast(text) {
        // Create toast if it doesn't exist
        let toast = document.getElementById("toast");
        if (!toast) {
          toast = document.createElement("div");
          toast.id = "toast";
          toast.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #00A859;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            font-family: 'Geist', sans-serif;
          `;
          document.body.appendChild(toast);
        }

        toast.textContent = text;
        toast.style.display = 'block';
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
          setTimeout(() => {
            toast.style.display = 'none';
          }, 300);
        }, 2000);
      }

      // Initialize the page
      renderBarber();

      /* ----------------------------
         SIDEBAR TOGGLE LOGIC
         ---------------------------- */
      const sidebar = document.getElementById("sidebar");
      const hamburgerBtn = document.getElementById("hamburger-btn");
      const overlay = document.getElementById("mobile-overlay");

      function toggleSidebar() {
        const isMobile = window.innerWidth <= 1024;
        if (isMobile) {
          sidebar.classList.toggle("mobile-open");
          if (sidebar.classList.contains("mobile-open")) {
            overlay.style.display = "block";
            setTimeout(() => (overlay.style.opacity = "1"), 10);
          } else {
            overlay.style.opacity = "0";
            setTimeout(() => (overlay.style.display = "none"), 300);
          }
        } else {
          sidebar.classList.toggle("collapsed");
        }
      }

      // Attach sidebar toggle listeners
      document.querySelectorAll(".sidebar-toggle-icon").forEach(el =>
        el.addEventListener("click", toggleSidebar)
      );
      
      hamburgerBtn.addEventListener("click", () => {
        hamburgerBtn.classList.toggle("active");
        toggleSidebar();
      });

      overlay.addEventListener("click", () => {
        sidebar.classList.remove("mobile-open");
        overlay.style.opacity = "0";
        setTimeout(() => (overlay.style.display = "none"), 300);
      });

      window.addEventListener("resize", () => {
        if (window.innerWidth > 768) {
          sidebar.classList.remove("mobile-open");
          overlay.style.display = "none";
          overlay.style.opacity = "0";
        }
      });

      // Favourite functions
      function toggleFavourite(id, name = "Barber") {
        let favs = getFavourites();
        id = String(id);

        if (favs.includes(id)) {
          favs = favs.filter((f) => f !== id);
          showToast(`${name} is removed from favourite`);
        } else {
          favs.push(id);
          showToast(`${name} is added to favourite`);
        }

        localStorage.setItem("favourites", JSON.stringify(favs));
      }

      // Load reviews from localStorage on page load
      window.addEventListener('DOMContentLoaded', () => {
        barbers[barberId].reviews.forEach((review, index) => {
          const savedReview = localStorage.getItem(`barber_${barberId}_review_${index}`);
          if (savedReview) {
            barbers[barberId].reviews[index] = JSON.parse(savedReview);
          }
        });
      });

    </script>
    
 <script src="./TrimlyNotifications.js"></script>


    <div id="toast"></div>

    <!-- BOOK SERVICE MODAL -->
    <div id="bookingModal" class="booking-modal">
      <div class="booking-overlay"></div>

      <div class="booking-box">
        <header class="booking-header">
          <h3>Book for a cut</h3>
          <button id="closeBooking">&times;</button>
        </header>
        <p style="color: #737373; font-size: 14px; margin-top: 5px">
          Fill in your information below to book for your haircut
        </p>

        <form class="booking-form">
          <label>
            Number of Persons
            <select id="personsSelect" required>
              <option value="">Choose number of persons</option>
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
              <option>6</option>
              <option>7</option>
              <option>8</option>
              <option>9</option>
              <option>10</option>
              <option>11</option>
              <option>12</option>
              <option>13</option>
              <option>14</option>
              <option>15</option>
              <option>16</option>
              <option>17</option>
              <option>18</option>
              <option>19</option>
              <option>20</option>
            </select>
            <p class="error-text" id="personsError"></p>
          </label>

          <label>
            Choose Date
            <input type="date" id="bookingDate" required />
            <p id="dateError" class="error-text"></p>
          </label>

          <label>
            Choose Time
          <select id="bookingTime" required>
  <option value="">Choose a time slot</option>
</select>
<p class="error-text" id="timeError"></p>

            <p class="error-text" id="timeError"></p>
          </label>

          <label>
            Additional Notes (optional)
            <textarea
              placeholder="Please include all information relevant to your issue"
            ></textarea>
          </label>

          <p class="amount">Amount: <strong id="totalAmount">‚Ç¶0</strong></p>

          <div class="booking-actions">
            <button type="button" class="cancelBooking">Cancel</button>
            <button type="button" class="pay-btn" id="proceedPayment">
              Proceed to payment
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- PAYMENT MODAL -->
    <div id="paymentModal" class="booking-modal payment-modal">
      <div class="booking-overlay"></div>

      <div class="booking-box payment-box">
        <header class="booking-header">
          <h3>Book for a cut</h3>
          <button onclick="closePaymentModal()">&times;</button>
        </header>

        <p class="payment-subtitle">
          Fill in your information below to book for your haircut
        </p>

        <!-- Payment Method -->
        <div class="payment-section">
          <p class="section-title">Payment Method</p>
          <p class="section-desc">
            Select the Payment Method that best fits your needs.
          </p>

          <div class="payment-methods">
            <label class="method-card">
              <input type="radio" name="paymentMethod" value="card" checked />
              <div>
                <span class="icon">üí≥</span>
                <span>Bank Card</span>
              </div>
            </label>

            <label class="method-card">
              <input type="radio" name="paymentMethod" value="transfer" />
              <div>
                <span class="icon">üè¶</span>
                <span>Bank Transfer</span>
              </div>
            </label>
          </div>
        </div>

        <!-- Form -->
        <form class="payment-form">
          <!-- DYNAMIC PAYMENT CONTENT -->
          <div id="paymentContent">
            <!-- CARD PAYMENT -->
            <div id="cardPayment">
              <label>
                Card Name
                <input type="text" placeholder="John Doe" />
              </label>

              <label class="card-number">
                Card Number
                <input type="text" placeholder="1234 5678 9054 3738" />
                
                <img src="/STATIC/Images/icons/visaMasterAmex.png" />
                
                </label>
              </label>

              <div class="form-row">
                <label>
                  Expiry Date
                  <input type="text" placeholder="MM/YY" />
                </label>

                <label>
                  CVC
                  <input type="text" placeholder="000" />
                </label>
              </div>

              <label>
                Country
                <select>
                  <option>Nigeria</option>
                  <option>Ghana</option>
                </select>
              </label>
            </div>

            <!-- BANK TRANSFER -->
            <div id="bankTransferPayment" style="display: none">
              <div class="transfer-box">
                <p class="transfer-title">Transfer to the account below</p>

                <div class="transfer-detail">
                  <span>Bank Name</span>
                  <strong>Polaris Bank</strong>
                </div>

                <div class="transfer-detail">
                  <span>Account Number</span>
                  <strong>4092130569</strong>
                </div>

                <div class="transfer-detail">
                  <span>Account Name</span>
                  <strong>Trimly Digital Grooming Limited</strong>
                </div>

                <p class="transfer-note">
                  Make the transfer and click <strong>Payment</strong> after
                  completion.
                </p>
              </div>
            </div>
          </div>

          <div class="booking-actions">
            <button
              type="button"
              class="cancelBooking"
              onclick="closePaymentModal()"
            >
              Cancel
            </button>
            <button type="button" onclick="confirmPayment(BOOKING_ID)" class="pay-btn" id="paymentBtn">
              Payment
            </button>
          </div>
        </form>
      </div>
    </div>

  </body>
</html>

