<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trimly | Messages</title>
    <link
      rel="icon"
      type="image/png"
      href="/STATIC/Images/icons/trimly logo.svg"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --font-family: "Geist", -apple-system, BlinkMacSystemFont, sans-serif;
        --color-bg-sidebar: #f9fafb;
        --color-bg-main: #ffffff;
        --color-text-primary: #000000;
        --color-text-secondary: #6b7280;
        --color-accent: rgba(218, 228, 243, 1);
        --color-border: #e5e7eb;
        --color-hover: rgba(240, 240, 240, 1);
        --sidebar-width-expanded: 250px;
        --sidebar-width-collapsed: 80px;
        --header-height: 80px;
        --transition-speed: 0.3s;

        /* Message Colors */
        --primary: #111827;
        --secondary: #3b82f6;
        --secondary-light: #60a5fa;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --info: #3b82f6;
        --white: #ffffff;
        --off-white: #f9fafb;
        --light-gray: #f3f4f6;
        --gray: #9ca3af;
        --dark-gray: #6b7280;
        --black: #111827;
        --radius: 10px;
        --radius-lg: 14px;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --message-sent: #3b82f6;
        --message-received: #f3f4f6;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, sans-serif;
        background: var(--off-white);
        color: var(--black);
        min-height: 100vh;
        line-height: 1.5;
        overflow-x: hidden;
      }

      /* App Container */
      .app-container {
        display: flex;
        height: 100vh;
        width: 100%;
      }

      /* Sidebar (same as dashboard) */
      .sidebar {
        width: var(--sidebar-width-expanded);
        background-color: var(--color-bg-sidebar);
        border-right: 1px solid var(--color-border);
        display: flex;
        flex-direction: column;
        transition: all var(--transition-speed);
        flex-shrink: 0;
        overflow-x: hidden;
        height: 100vh;
        position: relative;
        z-index: 1000;
      }

      .sidebar.collapsed {
        width: var(--sidebar-width-collapsed);
      }

      .sidebar.collapsed .logo-text,
      .sidebar.collapsed .nav-label,
      .sidebar.collapsed .social-icons {
        opacity: 0;
        pointer-events: none;
      }

      .sidebar.collapsed .logo-area {
        justify-content: center;
        padding: 20px 0;
      }

      .sidebar.collapsed .logo-text {
        display: none;
      }

      .sidebar.collapsed .sidebar-toggle-icon {
        display: flex !important;
        justify-content: center !important;
        width: 100% !important;
      }

      .sidebar.collapsed .sidebar-toggle-icon img {
        width: 36px !important;
        height: 36px !important;
        opacity: 1 !important;
        visibility: visible !important;
      }

      .sidebar-header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 24px;
      }

      .logo-area {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo-text {
        font-size: 20px;
        font-weight: 700;
      }

      .nav-list {
        flex: 1;
        padding: 16px 12px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .nav-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        border-radius: 8px;
        color: var(--color-text-secondary);
        transition: all 0.2s;
        gap: 12px;
        text-decoration: none;
      }

      .nav-item:hover {
        background-color: var(--color-hover);
        color: var(--color-text-primary);
      }

      .nav-item.active {
        background-color: var(--color-accent);
        color: var(--color-text-primary);
        font-weight: 500;
      }

      .nav-icon img {
        width: 18px;
        height: 18px;
      }

      .social-icons {
        padding: 24px;
        display: flex;
        justify-content: space-between;
        gap: 20px;
      }

      /* Mobile Overlay */
      #mobile-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 40;
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      /* Hamburger Button */
      .hamburger-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1002;
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: none;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
      }

      .hamburger-btn img {
        width: 24px;
        height: 24px;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background-color: var(--white);
        width: calc(100% - var(--sidebar-width-expanded));
        height: 100vh;
        transition: margin-left var(--transition-speed);
      }

      .sidebar.collapsed ~ .main-content {
        margin-left: var(--sidebar-width-collapsed);
        width: calc(100% - var(--sidebar-width-collapsed));
      }

      /* Messages Header */
      .messages-header {
        height: 70px;
        background: var(--white);
        border-bottom: 1px solid var(--light-gray);
        padding: 0 32px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 900;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .page-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--black);
      }

      .search-container {
        background-color: #f3f4f6;
        border-radius: 20px;
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        width: 300px;
      }

      .search-container input {
        border: none;
        background: transparent;
        outline: none;
        width: 100%;
        font-size: 14px;
        color: var(--black);
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .header-action-btn {
        position: relative;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--light-gray);
        background: var(--white);
        color: var(--dark-gray);
        cursor: pointer;
        transition: all 0.25s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .notification-badge {
        position: absolute;
        top: -4px;
        right: -4px;
        background: var(--error);
        color: var(--white);
        font-size: 0.7rem;
        font-weight: 600;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Messages Container */
      .messages-container {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      /* Conversations List */
      .conversations-list {
        width: 350px;
        border-right: 1px solid var(--light-gray);
        background: var(--white);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .conversations-header {
        padding: 20px;
        border-bottom: 1px solid var(--light-gray);
      }

      .conversations-header h3 {
        font-size: 1.2rem;
        margin-bottom: 15px;
      }

      .conversation-tabs {
        display: flex;
        gap: 10px;
        border-bottom: 1px solid var(--light-gray);
        padding-bottom: 10px;
      }

      .conversation-tab {
        padding: 8px 16px;
        border: none;
        background: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }

      .conversation-tab.active {
        background: var(--secondary);
        color: white;
      }

      .conversation-item {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid var(--light-gray);
        cursor: pointer;
        transition: all 0.2s;
        gap: 15px;
      }

      .conversation-item:hover {
        background: var(--off-white);
      }

      .conversation-item.active {
        background: var(--color-accent);
        border-left: 4px solid var(--secondary);
      }

      .conversation-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--light-gray);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: var(--dark-gray);
        position: relative;
      }

      .online-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 10px;
        height: 10px;
        background: var(--success);
        border-radius: 50%;
        border: 2px solid white;
      }

      .conversation-info {
        flex: 1;
        min-width: 0;
      }

      .conversation-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
      }

      .conversation-name {
        font-weight: 600;
        font-size: 15px;
        color: var(--black);
      }

      .conversation-time {
        font-size: 12px;
        color: var(--gray);
      }

      .conversation-preview {
        font-size: 13px;
        color: var(--dark-gray);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .unread-badge {
        background: var(--secondary);
        color: white;
        font-size: 12px;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: auto;
      }

      /* Chat Area */
      .chat-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--off-white);
      }

      .chat-header {
        padding: 20px 30px;
        background: white;
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .chat-user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .chat-user-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: var(--light-gray);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
      }

      .chat-user-details h4 {
        font-size: 16px;
        margin-bottom: 3px;
      }

      .chat-user-details p {
        font-size: 13px;
        color: var(--success);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .chat-actions {
        display: flex;
        gap: 10px;
      }

      .chat-actions button {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: 1px solid var(--light-gray);
        background: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Messages Area */
      .messages-area {
        flex: 1;
        padding: 20px 30px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .message-date {
        text-align: center;
        color: var(--gray);
        font-size: 12px;
        margin: 10px 0;
        padding: 5px 0;
      }

      .message {
        display: flex;
        gap: 10px;
        max-width: 70%;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.sent {
        align-self: flex-end;
        flex-direction: row-reverse;
      }

      .message.received {
        align-self: flex-start;
      }

      .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--light-gray);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        flex-shrink: 0;
      }

      .message-content {
        padding: 12px 16px;
        border-radius: 18px;
        font-size: 14px;
        line-height: 1.4;
        position: relative;
      }

      .message.sent .message-content {
        background: var(--message-sent);
        color: white;
        border-bottom-right-radius: 4px;
      }

      .message.received .message-content {
        background: var(--message-received);
        color: var(--black);
        border-bottom-left-radius: 4px;
      }

      .message-time {
        font-size: 11px;
        color: var(--gray);
        margin-top: 5px;
        text-align: right;
      }

      .message.sent .message-time {
        color: rgba(255, 255, 255, 0.8);
      }

      /* Message Input */
      .message-input-area {
        padding: 20px 30px;
        background: white;
        border-top: 1px solid var(--light-gray);
      }

      .message-input-container {
        display: flex;
        align-items: center;
        gap: 15px;
        background: var(--off-white);
        border-radius: 25px;
        padding: 10px 20px;
      }

      .message-input-actions {
        display: flex;
        gap: 10px;
      }

      .message-input-actions button {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: none;
        background: transparent;
        cursor: pointer;
        color: var(--gray);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .message-input-actions button:hover {
        background: var(--light-gray);
      }

      .message-input {
        flex: 1;
        border: none;
        background: transparent;
        outline: none;
        font-size: 14px;
        color: var(--black);
        padding: 8px 0;
      }

      .send-button {
        background: var(--secondary);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .send-button:hover {
        background: var(--secondary-light);
        transform: scale(1.05);
      }

      .send-button:disabled {
        background: var(--gray);
        cursor: not-allowed;
      }

      /* Empty State */
      .empty-chat {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--gray);
        text-align: center;
        padding: 40px;
      }

      .empty-chat i {
        font-size: 3rem;
        margin-bottom: 15px;
        color: var(--light-gray);
      }

      /* Responsive Design */
      @media (max-width: 1024px) {
        .sidebar {
          position: fixed;
          left: 0;
          top: 0;
          transform: translateX(-100%);
          z-index: 1000;
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0 !important;
          width: 100% !important;
        }

        .hamburger-btn {
          display: flex;
          transition: opacity 0.3s ease;
        }

        /* Hide hamburger when sidebar is open */
        .sidebar.mobile-open ~ .hamburger-btn {
          opacity: 0;
          pointer-events: none;
        }

        .conversations-list {
          width: 100%;
        }

        .chat-area {
          display: none;
        }

        .chat-area.active {
          display: flex;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: 100;
          background: var(--off-white);
        }

        .back-to-conversations {
          display: flex;
          align-items: center;
          gap: 10px;
          background: none;
          border: none;
          cursor: pointer;
          color: var(--secondary);
          font-size: 14px;
        }
      }

      @media (max-width: 768px) {
        .messages-header {
          padding: 0 16px;
          flex-direction: column;
          gap: 15px;
          height: auto;
          padding: 15px;
        }

        .header-left,
        .header-right {
          width: 100%;
          justify-content: space-between;
        }

        .search-container {
          width: 100%;
          max-width: 300px;
        }

        .conversations-list {
          width: 100%;
        }

        .message {
          max-width: 85%;
        }
      }

      @media (max-width: 480px) {
        .conversation-item {
          padding: 12px 15px;
        }

        .messages-area {
          padding: 15px;
        }

        .chat-header {
          padding: 15px;
        }

        .message-input-area {
          padding: 15px;
        }
      }

      .sidebar-toggle-icon:hover {
        background-color: var(--color-hover);
      }

      /* Quick fix to make hamburger match logo size */
      .hamburger-btn img {
        width: 18px !important;
        height: 18px !important;
      }

      /* Ensure sidebar logo is same size */
      .logo-area img,
      .sidebar-toggle-icon img {
        width: 18px;
        height: 18px;
      }

      /* Override any other conflicting styles */
      .sidebar.collapsed .sidebar-toggle-icon img {
        width: 18px !important;
        height: 18px !important;
      }

      /* Quick fix for modal styling */
      #newMessageModal .modal-content {
        background: white;
        border-radius: 14px;
        width: 90%;
        max-width: 500px;
        margin: auto;
      }

      #newMessageModal .modal-header {
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      #newMessageModal .modal-header h3 {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 600;
      }

      #newMessageModal .modal-body {
        padding: 20px;
      }

      #newMessageModal .form-group {
        margin-bottom: 20px;
      }

      #newMessageModal .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #4b5563;
      }

      #newMessageModal .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 1rem;
      }

      #newMessageModal .form-control:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      #newMessageModal textarea.form-control {
        resize: vertical;
        min-height: 100px;
      }

      #newMessageModal select.form-control {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236b7280' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 16px;
        appearance: none;
        padding-right: 40px;
      }

      #newMessageModal .modal-footer {
        padding: 20px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
      }

      #newMessageModal .btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        cursor: pointer;
      }

      #newMessageModal .btn-primary {
        background: #3b82f6;
        color: white;
      }

      #newMessageModal .btn-secondary {
        background: #f3f4f6;
        color: #4b5563;
        border: 1px solid #d1d5db;
      }

      /* Simple fixed position near the button */
      #newMessageModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1100;
      }

      #newMessageModal .modal-content {
        position: fixed;
        top: 100px; /* Position below header */
        right: 30px; /* Position from right edge */
        width: 400px;
        max-width: calc(100% - 60px);
        margin: 0;
        animation: modalAppear 0.3s ease;
      }

      @keyframes modalAppear {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-10px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      @media (max-width: 768px) {
        #newMessageModal .modal-content {
          position: fixed;
          top: 50%;
          left: 50%;
          right: auto;
          transform: translate(-50%, -50%);
          width: 90%;
          max-width: 400px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="logo-area">
            <span class="logo-text">Trimly</span>
            <i class="nav-icon sidebar-toggle-icon">
              <img src="/STATIC/Images/icons/trimly logo.svg" alt="" />
            </i>
          </div>
        </div>

        <nav class="nav-list">
          <a href="dashboard_barber.html" class="nav-item">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/Vector.svg" alt=""
            /></i>
            <span class="nav-label">Dashboard</span>
          </a>
          <a href="messages_barber.html" class="nav-item active">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/message.svg" alt=""
            /></i>
            <span class="nav-label">Messages</span>
            <span class="unread-badge" id="sidebarMessageCount">3</span>
          </a>
          <a href="booking_barber.html" class="nav-item">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/bookings.svg" alt=""
            /></i>
            <span class="nav-label">Bookings</span>
          </a>
          <a href="Settings_barber.html" class="nav-item">
            <i class="nav-icon"
              ><img src="/STATIC/Images/icons/settings.svg" alt=""
            /></i>
            <span class="nav-label">Settings</span>
          </a>
        </nav>

        <div class="social-icons">
          <a href="#"
            ><i><img src="/STATIC/Images/fb.svg" alt="" /></i
          ></a>
          <a href="#"
            ><i><img src="/STATIC/Images/icons/ig.svg" alt="" /></i
          ></a>
          <a href="#"
            ><i><img src="/STATIC/Images/icons/x.svg" alt="" /></i
          ></a>
          <a href="#"
            ><i><img src="/STATIC/Images/icons/messenger.svg" alt="" /></i
          ></a>
        </div>
      </aside>

      <!-- Hamburger Button -->
      <button
        id="hamburger-btn"
        class="hamburger-btn"
        aria-label="Toggle sidebar"
      >
        <img src="/STATIC/Images/icons/trimly logo.svg" alt="menu" />
      </button>

      <!-- Mobile Overlay -->
      <div id="mobile-overlay"></div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Messages Header -->
        <header class="messages-header">
          <div class="header-left">
            <button
              class="back-to-conversations"
              id="backButton"
              style="display: none"
            >
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <h1 class="page-title">Messages</h1>
            <div class="search-container">
              <i class="fas fa-search"></i>
              <input
                type="text"
                id="searchMessages"
                placeholder="Search messages..."
              />
            </div>
          </div>

          <div class="header-right">
            <button class="header-action-btn" id="notificationsBtn">
              <i class="fas fa-bell"></i>
              <span class="notification-badge" id="notificationCount">5</span>
            </button>
            <button
              class="header-action-btn"
              id="newMessageBtn"
              title="New Message"
            >
              <i class="fas fa-edit"></i>
            </button>
          </div>
        </header>

        <!-- Messages Container -->
        <div class="messages-container">
          <!-- Conversations List -->
          <div class="conversations-list" id="conversationsList">
            <div class="conversations-header">
              <h3>Conversations</h3>
              <div class="conversation-tabs">
                <button class="conversation-tab active" data-tab="all">
                  All
                </button>
                <button class="conversation-tab" data-tab="unread">
                  Unread
                </button>
                <button class="conversation-tab" data-tab="clients">
                  Clients
                </button>
              </div>
            </div>
            <!-- Conversations will be loaded here -->
          </div>

          <!-- Chat Area -->
          <div class="chat-area" id="chatArea">
            <div class="empty-chat" id="emptyChat">
              <i class="far fa-comments"></i>
              <h3>No conversation selected</h3>
              <p>Select a conversation from the list to start messaging</p>
            </div>

            <!-- Active Chat (hidden by default) -->
            <div class="active-chat" id="activeChat" style="display: none">
              <div class="chat-header">
                <div class="chat-user-info">
                  <div class="chat-user-avatar" id="chatUserAvatar">JD</div>
                  <div class="chat-user-details">
                    <h4 id="chatUserName">John Doe</h4>
                    <p><span class="online-indicator"></span> Online</p>
                  </div>
                </div>
                <div class="chat-actions">
                  <button title="Call">
                    <i class="fas fa-phone"></i>
                  </button>
                  <button title="Video Call">
                    <i class="fas fa-video"></i>
                  </button>
                  <button title="More options">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                </div>
              </div>

              <div class="messages-area" id="messagesArea">
                <!-- Messages will be loaded here -->
                <div class="message-date">Today</div>
              </div>

              <div class="message-input-area">
                <div class="message-input-container">
                  <div class="message-input-actions">
                    <button title="Attach file">
                      <i class="fas fa-paperclip"></i>
                    </button>
                    <button title="Add emoji">
                      <i class="far fa-smile"></i>
                    </button>
                  </div>
                  <input
                    type="text"
                    class="message-input"
                    id="messageInput"
                    placeholder="Type your message..."
                  />
                  <button class="send-button" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- New Message Modal -->
    <div class="modal" id="newMessageModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>New Message</h3>
          <button class="btn-icon close-modal" onclick="closeNewMessageModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="recipientSelect"><i class="fas fa-user"></i> To</label>
            <select id="recipientSelect" class="form-control">
              <option value="">Select a client</option>
              <!-- Options will be populated -->
            </select>
          </div>
          <div class="form-group">
            <label for="newMessageText"
              ><i class="fas fa-comment"></i> Message</label
            >
            <textarea
              id="newMessageText"
              rows="4"
              class="form-control"
              placeholder="Type your message..."
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeNewMessageModal()">
            Cancel
          </button>
          <button class="btn btn-primary" onclick="sendNewMessage()">
            Send Message
          </button>
        </div>
      </div>
    </div>

    <script>
      // Messages Data
      let conversations =
        JSON.parse(localStorage.getItem("trimly_conversations")) || [];
      let currentUser = JSON.parse(localStorage.getItem("onboardingData"))
        ?.profile || { name: "Barber" };
      let activeConversationId = null;

      // Sample data if empty
      if (conversations.length === 0) {
        conversations = [
          {
            id: 1,
            clientId: 101,
            clientName: "John Doe",
            clientAvatar: "JD",
            lastMessage: "Thanks for the great haircut yesterday!",
            lastMessageTime: "10:30 AM",
            unreadCount: 2,
            messages: [
              {
                id: 1,
                sender: "client",
                text: "Hi, I'd like to book an appointment for tomorrow",
                time: "Yesterday, 2:30 PM",
                read: true,
              },
              {
                id: 2,
                sender: "you",
                text: "Sure John! What time works for you?",
                time: "Yesterday, 2:45 PM",
                read: true,
              },
              {
                id: 3,
                sender: "client",
                text: "How about 3 PM?",
                time: "Yesterday, 3:00 PM",
                read: true,
              },
              {
                id: 4,
                sender: "you",
                text: "3 PM works perfectly. See you then!",
                time: "Yesterday, 3:15 PM",
                read: true,
              },
              {
                id: 5,
                sender: "client",
                text: "Thanks for the great haircut yesterday!",
                time: "Today, 10:30 AM",
                read: false,
              },
              {
                id: 6,
                sender: "client",
                text: "My friends really liked it too",
                time: "Today, 10:31 AM",
                read: false,
              },
            ],
            isOnline: true,
          },
          {
            id: 2,
            clientId: 102,
            clientName: "Michael Smith",
            clientAvatar: "MS",
            lastMessage: "Can I get a beard trim this weekend?",
            lastMessageTime: "9:45 AM",
            unreadCount: 1,
            messages: [
              {
                id: 1,
                sender: "client",
                text: "Hi, are you available this weekend?",
                time: "Today, 9:45 AM",
                read: false,
              },
            ],
            isOnline: false,
          },
          {
            id: 3,
            clientId: 103,
            clientName: "Robert Johnson",
            clientAvatar: "RJ",
            lastMessage: "See you at 4 PM today",
            lastMessageTime: "Yesterday, 6:30 PM",
            unreadCount: 0,
            messages: [
              {
                id: 1,
                sender: "you",
                text: "Your appointment is confirmed for 4 PM today",
                time: "Yesterday, 6:30 PM",
                read: true,
              },
            ],
            isOnline: true,
          },
          {
            id: 4,
            clientId: 104,
            clientName: "James Wilson",
            clientAvatar: "JW",
            lastMessage: "Thanks for the hair color service",
            lastMessageTime: "2 days ago",
            unreadCount: 0,
            messages: [
              {
                id: 1,
                sender: "client",
                text: "Thanks for the hair color service, it looks amazing!",
                time: "2 days ago",
                read: true,
              },
            ],
            isOnline: false,
          },
        ];
        localStorage.setItem(
          "trimly_conversations",
          JSON.stringify(conversations)
        );
      }

      // Initialize
      function initMessages() {
        loadConversations();
        setupEventListeners();
        updateUnreadCounts();

        // Check for URL parameter to open specific conversation
        const urlParams = new URLSearchParams(window.location.search);
        const conversationId = urlParams.get("conversation");
        if (conversationId) {
          openConversation(parseInt(conversationId));
        }

        // Initialize sidebar
        initSidebar();
      }

      function initSidebar() {
        const sidebar = document.getElementById("sidebar");
        const hamburgerBtn = document.getElementById("hamburger-btn");
        const overlay = document.getElementById("mobile-overlay");
        const toggleIcons = document.querySelectorAll(".sidebar-toggle-icon");

        // Add event listeners for sidebar toggle
        if (hamburgerBtn) {
          hamburgerBtn.addEventListener("click", toggleSidebar);
        }

        if (toggleIcons.length > 0) {
          toggleIcons.forEach((icon) => {
            icon.addEventListener("click", toggleSidebar);
          });
        }

        if (overlay) {
          overlay.addEventListener("click", () => {
            sidebar.classList.remove("mobile-open");
            overlay.style.opacity = "0";
            setTimeout(() => (overlay.style.display = "none"), 300);
          });
        }

        // Handle window resize
        window.addEventListener("resize", () => {
          if (window.innerWidth > 1024) {
            sidebar.classList.remove("mobile-open");
            if (overlay) {
              overlay.style.display = "none";
              overlay.style.opacity = "0";
            }
          }
        });
      }

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("mobile-overlay");
        const isMobile = window.innerWidth <= 1024;

        if (isMobile) {
          sidebar.classList.toggle("mobile-open");
          if (sidebar.classList.contains("mobile-open")) {
            if (overlay) {
              overlay.style.display = "block";
              setTimeout(() => (overlay.style.opacity = "1"), 10);
            }
          } else {
            if (overlay) {
              overlay.style.opacity = "0";
              setTimeout(() => (overlay.style.display = "none"), 300);
            }
          }
        } else {
          // For desktop, toggle collapsed state
          sidebar.classList.toggle("collapsed");
        }
      }

      function loadConversations() {
        const container = document.getElementById("conversationsList");
        const listContainer = container.querySelector(
          ".conversations-header"
        )?.nextElementSibling;

        if (listContainer) {
          listContainer.remove();
        }

        const list = document.createElement("div");
        list.className = "conversations-container";

        conversations.forEach((conversation) => {
          const conversationItem = document.createElement("div");
          conversationItem.className = `conversation-item ${
            activeConversationId === conversation.id ? "active" : ""
          }`;
          conversationItem.dataset.id = conversation.id;

          conversationItem.innerHTML = `
            <div class="conversation-avatar">
              ${conversation.clientAvatar}
              ${
                conversation.isOnline
                  ? '<span class="online-indicator"></span>'
                  : ""
              }
            </div>
            <div class="conversation-info">
              <div class="conversation-header">
                <span class="conversation-name">${
                  conversation.clientName
                }</span>
                <span class="conversation-time">${
                  conversation.lastMessageTime
                }</span>
              </div>
              <div class="conversation-preview">${
                conversation.lastMessage
              }</div>
            </div>
            ${
              conversation.unreadCount > 0
                ? `<span class="unread-badge">${conversation.unreadCount}</span>`
                : ""
            }
          `;

          conversationItem.addEventListener("click", () =>
            openConversation(conversation.id)
          );
          list.appendChild(conversationItem);
        });

        container.appendChild(list);
      }

      function openConversation(id) {
        activeConversationId = id;
        const conversation = conversations.find((c) => c.id === id);

        if (!conversation) return;

        // Update UI
        document.getElementById("emptyChat").style.display = "none";
        document.getElementById("activeChat").style.display = "block";
        document.getElementById("chatUserName").textContent =
          conversation.clientName;
        document.getElementById("chatUserAvatar").textContent =
          conversation.clientAvatar;

        // Mark messages as read
        conversation.messages.forEach((msg) => (msg.read = true));
        conversation.unreadCount = 0;
        localStorage.setItem(
          "trimly_conversations",
          JSON.stringify(conversations)
        );

        // Update UI counts
        updateUnreadCounts();
        loadConversations();

        // Load messages
        loadMessages(conversation.messages);

        // Update URL
        history.pushState({}, "", `?conversation=${id}`);

        // On mobile, show chat area
        if (window.innerWidth <= 1024) {
          document.getElementById("conversationsList").style.display = "none";
          document.getElementById("chatArea").classList.add("active");
          document.getElementById("backButton").style.display = "flex";
        }
      }

      function loadMessages(messages) {
        const container = document.getElementById("messagesArea");
        container.innerHTML = '<div class="message-date">Today</div>';

        messages.forEach((message) => {
          const messageElement = document.createElement("div");
          messageElement.className = `message ${
            message.sender === "you" ? "sent" : "received"
          }`;

          messageElement.innerHTML = `
            <div class="message-avatar">${
              message.sender === "you"
                ? currentUser.name?.charAt(0) || "B"
                : message.sender.charAt(0)
            }</div>
            <div class="message-content">
              <div class="message-text">${message.text}</div>
              <div class="message-time">${message.time}</div>
            </div>
          `;

          container.appendChild(messageElement);
        });

        // Scroll to bottom
        container.scrollTop = container.scrollHeight;
      }

      function sendMessage() {
        const input = document.getElementById("messageInput");
        const text = input.value.trim();

        if (!text || !activeConversationId) return;

        const conversation = conversations.find(
          (c) => c.id === activeConversationId
        );
        if (!conversation) return;

        // Create new message
        const newMessage = {
          id: conversation.messages.length + 1,
          sender: "you",
          text: text,
          time: "Just now",
          read: true,
        };

        // Update conversation
        conversation.messages.push(newMessage);
        conversation.lastMessage = text;
        conversation.lastMessageTime = "Just now";
        conversation.unreadCount = 0; // Reset unread count since you sent the message

        // Save to localStorage
        localStorage.setItem(
          "trimly_conversations",
          JSON.stringify(conversations)
        );

        // Update UI
        loadMessages(conversation.messages);
        loadConversations();
        updateUnreadCounts();

        // Clear input
        input.value = "";

        // Simulate reply after 1 second
        setTimeout(() => {
          const replyMessage = {
            id: conversation.messages.length + 1,
            sender: "client",
            text: getRandomReply(),
            time: "Just now",
            read: false,
          };

          conversation.messages.push(replyMessage);
          conversation.lastMessage = replyMessage.text;
          conversation.lastMessageTime = "Just now";
          conversation.unreadCount = 1;

          localStorage.setItem(
            "trimly_conversations",
            JSON.stringify(conversations)
          );
          loadMessages(conversation.messages);
          loadConversations();
          updateUnreadCounts();
        }, 1000);
      }

      function getRandomReply() {
        const replies = [
          "Sounds good!",
          "Thanks for letting me know",
          "Perfect, see you then",
          "Looking forward to it",
          "That works for me",
          "Great, thank you!",
          "I appreciate it",
          "Will do, thanks!",
          "See you soon!",
          "Thanks for the update",
        ];
        return replies[Math.floor(Math.random() * replies.length)];
      }

      function updateUnreadCounts() {
        // Calculate total unread messages
        const totalUnread = conversations.reduce(
          (total, conv) => total + conv.unreadCount,
          0
        );

        // Update sidebar badge
        document.getElementById("sidebarMessageCount").textContent =
          totalUnread;

        // Update notification badge
        document.getElementById("notificationCount").textContent =
          totalUnread > 0 ? totalUnread : "";

        // Update dashboard if we're in an iframe or using broadcast channel
        updateDashboardBadge(totalUnread);
      }

      function updateDashboardBadge(count) {
        // Update localStorage so dashboard can read it
        localStorage.setItem("trimly_unread_messages", count);

        // Send message to dashboard if it's open
        if (typeof BroadcastChannel !== "undefined") {
          const bc = new BroadcastChannel("trimly_messages");
          bc.postMessage({ type: "unread_update", count: count });
        }
      }

      function setupEventListeners() {
        // Message input
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");

        messageInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        });

        sendButton.addEventListener("click", sendMessage);

        // New message button
        document
          .getElementById("newMessageBtn")
          .addEventListener("click", openNewMessageModal);

        // Back button (mobile)
        document.getElementById("backButton").addEventListener("click", () => {
          document.getElementById("conversationsList").style.display = "block";
          document.getElementById("chatArea").classList.remove("active");
          document.getElementById("backButton").style.display = "none";
          document.getElementById("emptyChat").style.display = "flex";
          document.getElementById("activeChat").style.display = "none";
        });

        // Search
        document
          .getElementById("searchMessages")
          .addEventListener("input", filterConversations);

        // Tabs
        document.querySelectorAll(".conversation-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            document
              .querySelectorAll(".conversation-tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");
            filterConversationsByTab(tab.dataset.tab);
          });
        });

        // Modal close on outside click
        window.addEventListener("click", (event) => {
          const modal = document.getElementById("newMessageModal");
          if (event.target === modal) {
            closeNewMessageModal();
          }
        });
      }

      // Sidebar functionality
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("mobile-overlay");
        const hamburgerBtn = document.getElementById("hamburger-btn");
        const isMobile = window.innerWidth <= 1024;

        if (isMobile) {
          sidebar.classList.toggle("mobile-open");
          if (sidebar.classList.contains("mobile-open")) {
            overlay.style.display = "block";
            setTimeout(() => (overlay.style.opacity = "1"), 10);
            // Hamburger button will be hidden by CSS when sidebar is open
          } else {
            overlay.style.opacity = "0";
            setTimeout(() => (overlay.style.display = "none"), 300);
            // Hamburger button will be visible again when sidebar is closed
          }
        } else {
          sidebar.classList.toggle("collapsed");
        }
      }

      function openNewMessageModal() {
        const modal = document.getElementById("newMessageModal");
        const select = document.getElementById("recipientSelect");

        // Populate recipients from bookings
        const bookings = JSON.parse(localStorage.getItem("bookings")) || [];
        const clients = [...new Set(bookings.map((b) => b.customer))];

        select.innerHTML = '<option value="">Select a client</option>';
        clients.forEach((client) => {
          const option = document.createElement("option");
          option.value = client;
          option.textContent = client;
          select.appendChild(option);
        });

        modal.style.display = "flex";
      }

      function closeNewMessageModal() {
        document.getElementById("newMessageModal").style.display = "none";
        document.getElementById("newMessageText").value = "";
      }

      function sendNewMessage() {
        const recipient = document.getElementById("recipientSelect").value;
        const message = document.getElementById("newMessageText").value.trim();

        if (!recipient || !message) {
          alert("Please select a recipient and enter a message");
          return;
        }

        // Create new conversation
        const newConversation = {
          id: conversations.length + 1,
          clientId: Date.now(),
          clientName: recipient,
          clientAvatar: recipient.charAt(0).toUpperCase(),
          lastMessage: message,
          lastMessageTime: "Just now",
          unreadCount: 0,
          messages: [
            {
              id: 1,
              sender: "you",
              text: message,
              time: "Just now",
              read: true,
            },
          ],
          isOnline: false,
        };

        conversations.unshift(newConversation);
        localStorage.setItem(
          "trimly_conversations",
          JSON.stringify(conversations)
        );

        closeNewMessageModal();
        loadConversations();
        openConversation(newConversation.id);
        showToast("Message sent successfully", "success");
      }

      function filterConversations() {
        const searchTerm = document
          .getElementById("searchMessages")
          .value.toLowerCase();
        const items = document.querySelectorAll(".conversation-item");

        items.forEach((item) => {
          const name = item
            .querySelector(".conversation-name")
            .textContent.toLowerCase();
          const preview = item
            .querySelector(".conversation-preview")
            .textContent.toLowerCase();

          if (name.includes(searchTerm) || preview.includes(searchTerm)) {
            item.style.display = "flex";
          } else {
            item.style.display = "none";
          }
        });
      }

      function filterConversationsByTab(tab) {
        const items = document.querySelectorAll(".conversation-item");

        items.forEach((item) => {
          const unreadBadge = item.querySelector(".unread-badge");
          const hasUnread = unreadBadge !== null;

          switch (tab) {
            case "all":
              item.style.display = "flex";
              break;
            case "unread":
              item.style.display = hasUnread ? "flex" : "none";
              break;
            case "clients":
              // For now, show all (you could filter by client vs other barbers)
              item.style.display = "flex";
              break;
          }
        });
      }

      function showToast(message, type = "info") {
        // Create toast if it doesn't exist
        let toast = document.getElementById("messageToast");
        if (!toast) {
          toast = document.createElement("div");
          toast.id = "messageToast";
          toast.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            background: ${type === "success" ? "#10b981" : "#3b82f6"};
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 9999;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
          `;
          document.body.appendChild(toast);
        }

        toast.textContent = message;
        toast.style.background = type === "success" ? "#10b981" : "#3b82f6";

        // Show toast
        setTimeout(() => {
          toast.style.transform = "translateY(0)";
          toast.style.opacity = "1";
        }, 10);

        // Hide after 3 seconds
        setTimeout(() => {
          toast.style.transform = "translateY(100px)";
          toast.style.opacity = "0";
        }, 3000);
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", initMessages);
    </script>
  </body>
</html>
